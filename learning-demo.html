<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Learning Demo – Foodsim Machine Learning Lab</title>
  <style>
    :root {
      --bg1: #050516;
      --bg2: #111633;
      --bg3: #1a1f40;
      --ink: #f5f7ff;
      --muted: #9aa6c8;
      --accent: #f97316;
      --accent-2: #38bdf8;
      --card: rgba(16, 22, 54, 0.78);
      --card-strong: rgba(18, 26, 65, 0.92);
      --border: rgba(148, 163, 209, 0.26);
      --shadow: 0 28px 58px rgba(8, 12, 34, 0.52);
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: radial-gradient(circle at 20% -10%, rgba(56, 189, 248, 0.28), transparent 45%),
                  radial-gradient(circle at 80% 0%, rgba(249, 115, 22, 0.32), transparent 55%),
                  linear-gradient(155deg, var(--bg1) 0%, var(--bg2) 46%, var(--bg3) 100%);
      color: var(--ink);
      display: flex;
      flex-direction: column;
    }
    header {
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(18px);
      background: linear-gradient(120deg, rgba(8, 11, 29, 0.92) 0%, rgba(10, 13, 33, 0.72) 55%, rgba(14, 18, 45, 0.35) 100%);
      border-bottom: 1px solid rgba(148, 163, 209, 0.18);
    }
    .nav {
      max-width: 1120px;
      margin: 0 auto;
      padding: 20px 28px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 24px;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
      color: inherit;
    }
    .brand-icon {
      width: 42px;
      height: 42px;
      border-radius: 14px;
      background: linear-gradient(140deg, rgba(56, 189, 248, 0.45), rgba(249, 115, 22, 0.58));
      display: grid;
      place-items: center;
      font-size: 18px;
      font-weight: 600;
      box-shadow: 0 18px 42px rgba(56, 189, 248, 0.2);
    }
    .brand h1 {
      margin: 0;
      font-size: clamp(1.1rem, 2.2vw, 1.55rem);
      font-weight: 600;
      letter-spacing: 0.02em;
    }
    .brand small {
      color: var(--muted);
      letter-spacing: 0.08em;
      text-transform: uppercase;
      font-size: 0.72rem;
    }
    .nav-links {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      font-size: 0.95rem;
    }
    .nav-links a {
      color: var(--muted);
      text-decoration: none;
      transition: color 0.25s ease;
    }
    .nav-links a:hover {
      color: var(--ink);
    }
    main {
      flex: 1;
    }
    .hero {
      max-width: 1120px;
      margin: 64px auto 44px;
      padding: 0 28px;
      display: grid;
      gap: 18px;
    }
    .hero h2 {
      margin: 0;
      font-size: clamp(2.2rem, 4.8vw, 3.2rem);
    }
    .hero p {
      margin: 0;
      color: var(--muted);
      font-size: 1.05rem;
      line-height: 1.65;
      max-width: 780px;
    }
    .callouts {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 18px;
    }
    .callout {
      background: rgba(14, 18, 45, 0.72);
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 209, 0.2);
      padding: 18px 20px;
      display: grid;
      gap: 8px;
    }
    .callout strong {
      font-size: 0.92rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: rgba(148, 163, 209, 0.82);
    }
    .callout span {
      color: var(--muted);
      font-size: 0.95rem;
      line-height: 1.55;
    }
    .lab {
      max-width: 1120px;
      margin: 0 auto 96px;
      padding: 0 28px 80px;
      display: grid;
      gap: 28px;
    }
    .lab-header {
      display: grid;
      gap: 12px;
    }
    .lab-header h3 {
      margin: 0;
      font-size: clamp(1.9rem, 4.2vw, 2.4rem);
    }
    .lab-header p {
      margin: 0;
      color: var(--muted);
      line-height: 1.6;
      max-width: 780px;
    }
    .lab-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.05fr) minmax(0, 0.95fr);
      gap: 26px;
    }
    .panel {
      background: var(--card);
      border-radius: 24px;
      border: 1px solid rgba(148, 163, 209, 0.22);
      padding: 24px;
      box-shadow: var(--shadow);
      display: grid;
      gap: 18px;
    }
    .panel h4 {
      margin: 0;
      font-size: 1.22rem;
    }
    .panel p {
      margin: 0;
      color: var(--muted);
      line-height: 1.55;
      font-size: 0.96rem;
    }
    .document-stream {
      display: grid;
      gap: 14px;
    }
    .doc-card {
      position: relative;
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 16px;
      align-items: center;
      padding: 16px 18px;
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 209, 0.22);
      background: rgba(10, 14, 36, 0.7);
      color: inherit;
      text-align: left;
      cursor: pointer;
      transition: transform 0.25s ease, border-color 0.25s ease, background 0.25s ease;
    }
    .doc-card:hover {
      transform: translateY(-2px);
      border-color: rgba(56, 189, 248, 0.45);
      background: rgba(16, 24, 52, 0.78);
    }
    .doc-card.active {
      border-color: rgba(56, 189, 248, 0.65);
      box-shadow: 0 18px 44px rgba(56, 189, 248, 0.22);
      background: var(--card-strong);
    }
    .doc-icon {
      width: 48px;
      height: 48px;
      border-radius: 16px;
      display: grid;
      place-items: center;
      font-weight: 700;
      font-size: 1.15rem;
      text-transform: uppercase;
      letter-spacing: 0.02em;
    }
    .doc-icon.incident {
      background: rgba(56, 189, 248, 0.22);
      color: var(--accent-2);
      border: 1px solid rgba(56, 189, 248, 0.5);
    }
    .doc-icon.service {
      background: rgba(249, 115, 22, 0.18);
      color: var(--accent);
      border: 1px solid rgba(249, 115, 22, 0.45);
    }
    .doc-details {
      display: grid;
      gap: 4px;
    }
    .doc-details strong {
      font-size: 1rem;
    }
    .doc-meta {
      color: var(--muted);
      font-size: 0.88rem;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .doc-confidence {
      font-size: 0.85rem;
      color: rgba(148, 163, 209, 0.8);
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }
    .controls button {
      background: rgba(56, 189, 248, 0.22);
      border: 1px solid rgba(56, 189, 248, 0.42);
      color: var(--ink);
      border-radius: 999px;
      padding: 11px 22px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.25s ease, box-shadow 0.25s ease;
    }
    .controls button:hover {
      transform: translateY(-2px);
      box-shadow: 0 18px 40px rgba(56, 189, 248, 0.18);
    }
    .controls button.secondary {
      background: rgba(12, 18, 44, 0.7);
      border-color: rgba(148, 163, 209, 0.35);
    }
    .status-line {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.9rem;
      color: var(--muted);
    }
    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(56, 189, 248, 0.7);
      box-shadow: 0 0 12px rgba(56, 189, 248, 0.55);
    }
    .timeline {
      display: grid;
      gap: 8px;
    }
    .timeline-track {
      position: relative;
      height: 6px;
      border-radius: 999px;
      background: rgba(148, 163, 209, 0.18);
      overflow: hidden;
    }
    .timeline-fill {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      background: linear-gradient(90deg, rgba(56, 189, 248, 0.35), rgba(249, 115, 22, 0.75));
      border-radius: 999px;
      width: 0%;
      transition: width 0.5s ease;
    }
    .timeline span {
      font-size: 0.85rem;
      color: var(--muted);
    }
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 16px;
    }
    .metric-card {
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 209, 0.2);
      background: rgba(10, 14, 36, 0.68);
      padding: 16px;
      display: grid;
      gap: 6px;
    }
    .metric-card span.label {
      font-size: 0.8rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: rgba(148, 163, 209, 0.78);
    }
    .metric-card span.value {
      font-size: 1.4rem;
      font-weight: 600;
    }
    .visual-board {
      display: grid;
      gap: 20px;
    }
    .focus-panel {
      background: rgba(14, 20, 48, 0.82);
      border-radius: 20px;
      border: 1px solid rgba(56, 189, 248, 0.32);
      padding: 20px 22px;
      display: grid;
      gap: 14px;
    }
    .focus-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 18px;
      flex-wrap: wrap;
    }
    .focus-header strong {
      font-size: 1.1rem;
    }
    .badge {
      padding: 4px 12px;
      border-radius: 999px;
      font-size: 0.82rem;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }
    .badge.incident {
      background: rgba(56, 189, 248, 0.2);
      color: var(--accent-2);
    }
    .badge.service {
      background: rgba(249, 115, 22, 0.2);
      color: var(--accent);
    }
    .feature-bars {
      display: grid;
      gap: 12px;
    }
    .feature-bar {
      display: grid;
      gap: 6px;
    }
    .feature-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      font-size: 0.9rem;
      color: rgba(148, 163, 209, 0.88);
    }
    .feature-value {
      color: var(--ink);
      font-weight: 600;
    }
    .feature-track {
      height: 10px;
      border-radius: 999px;
      background: rgba(148, 163, 209, 0.18);
      overflow: hidden;
    }
    .feature-fill {
      display: block;
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(56, 189, 248, 0.35), rgba(249, 115, 22, 0.78));
      width: 0%;
      transition: width 0.4s ease;
    }
    .decision-panel {
      background: rgba(9, 14, 36, 0.78);
      border-radius: 20px;
      border: 1px solid rgba(148, 163, 209, 0.24);
      padding: 20px 22px;
      display: grid;
      gap: 12px;
    }
    .decision-track {
      position: relative;
      height: 54px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(249, 115, 22, 0.65), rgba(56, 189, 248, 0.65));
      padding: 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      color: rgba(15, 20, 38, 0.78);
      font-weight: 600;
      font-size: 0.9rem;
    }
    .decision-track span {
      padding: 0 8px;
    }
    .decision-indicator {
      position: absolute;
      top: 50%;
      transform: translate(-50%, -50%);
      min-width: 86px;
      padding: 10px 14px;
      border-radius: 999px;
      background: rgba(5, 7, 18, 0.86);
      border: 1px solid rgba(255, 255, 255, 0.12);
      display: grid;
      place-items: center;
      font-size: 0.92rem;
      font-weight: 600;
      color: var(--ink);
      transition: left 0.45s ease;
    }
    .weights-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 16px;
    }
    .weight-card {
      border-radius: 18px;
      padding: 16px;
      background: rgba(10, 14, 34, 0.7);
      border: 1px solid rgba(148, 163, 209, 0.22);
      display: grid;
      gap: 8px;
    }
    .weight-card span.value {
      font-size: 1.26rem;
      font-weight: 600;
    }
    .weight-bar {
      position: relative;
      height: 8px;
      border-radius: 999px;
      background: rgba(148, 163, 209, 0.18);
      overflow: hidden;
    }
    .weight-bar::after {
      content: "";
      position: absolute;
      top: 0;
      left: 50%;
      width: 1px;
      height: 100%;
      background: rgba(148, 163, 209, 0.3);
    }
    .weight-bar span {
      position: absolute;
      top: 0;
      height: 100%;
      background: linear-gradient(135deg, rgba(56, 189, 248, 0.5), rgba(249, 115, 22, 0.6));
      border-radius: 999px;
      transform-origin: left center;
    }
    .chart-panel {
      background: rgba(7, 10, 28, 0.9);
      border-radius: 20px;
      border: 1px solid rgba(148, 163, 209, 0.22);
      padding: 20px;
      display: grid;
      gap: 12px;
    }
    .chart-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 16px;
      flex-wrap: wrap;
    }
    .muted {
      color: var(--muted);
    }
    .signal-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      width: 100%;
    }
    .signal-card {
      background: rgba(9, 12, 31, 0.75);
      border: 1px solid rgba(148, 163, 209, 0.24);
      border-radius: 14px;
      padding: 12px 14px;
      display: grid;
      gap: 2px;
    }
    .signal-card .label {
      font-size: 0.82rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: rgba(148, 163, 209, 0.9);
    }
    .signal-card .value {
      font-size: 1.2rem;
      font-weight: 600;
    }
    .signal-card small {
      color: var(--muted);
    }
    canvas {
      width: 100%;
      height: 220px;
      display: block;
    }
    .log {
      display: grid;
      gap: 12px;
      max-height: 360px;
      overflow-y: auto;
      padding-right: 6px;
    }
    .log-entry {
      background: rgba(9, 13, 34, 0.72);
      border: 1px solid rgba(148, 163, 209, 0.24);
      border-radius: 16px;
      padding: 14px 16px;
      font-size: 0.92rem;
      line-height: 1.55;
    }
    footer {
      margin-top: auto;
      padding: 32px 24px 48px;
      text-align: center;
      color: var(--muted);
      font-size: 0.92rem;
    }
    @media (max-width: 1080px) {
      .lab-grid {
        grid-template-columns: 1fr;
      }
    }
    @media (max-width: 720px) {
      .nav {
        flex-direction: column;
        align-items: flex-start;
      }
      .hero {
        margin-top: 48px;
      }
      .controls {
        flex-direction: column;
        align-items: stretch;
      }
      .controls button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <header>
    <nav class="nav">
      <a class="brand" href="index.html">
        <span class="brand-icon">ML</span>
        <div>
          <h1>Foodsim Machine Learning Lab</h1>
          <small>Interactive learning environment</small>
        </div>
      </a>
      <div class="nav-links">
        <a href="index.html">Back to home</a>
        <a href="index.html#experiments">Explore experiments</a>
      </div>
    </nav>
  </header>
  <main>
    <section class="hero">
      <h2>See the AI learn the difference between incidents and service requests</h2>
      <p>Instead of watching raw math scroll by, this demo lets you feel every learning step. Follow the support tickets as they flow through the pipeline, see the feature strengths light up, and watch the decision needle move when the model becomes confident.</p>
      <div class="callouts">
        <article class="callout">
          <strong>1 · Read</strong>
          <span>The AI scans a ticket and records three signals: how long it is, how urgent the wording sounds, and how much impact language it contains.</span>
        </article>
        <article class="callout">
          <strong>2 · Compare</strong>
          <span>Those features turn into coloured bars. Together with the learned weights they produce an incident probability between 0% and 100%.</span>
        </article>
        <article class="callout">
          <strong>3 · Adjust</strong>
          <span>If the guess is off, the weights slide toward the right answer. Watch them drift in the cards below.</span>
        </article>
      </div>
    </section>
    <section class="lab">
      <div class="lab-header">
        <h3>Interactive learning lab</h3>
        <p>Press play to run the training loop automatically, step through one ticket at a time, or reset to start from scratch. The visuals update immediately so you can see why the classifier leans toward “incident” or “service request”.</p>
      </div>
      <div class="lab-grid">
        <aside class="panel">
          <h4>Ticket stream</h4>
          <p>Each card represents a ticket the AI studies. Click any card to inspect it, or let the training loop highlight the active one.</p>
          <div class="document-stream" id="documentStream"></div>
          <div class="controls">
            <button id="playButton">Play training</button>
            <button id="stepButton" class="secondary">Step once</button>
            <button id="resetButton" class="secondary">Reset</button>
          </div>
          <div class="status-line">
            <span class="status-dot"></span>
            <span id="statusText">The model is idle and ready.</span>
          </div>
          <div class="timeline">
            <span><strong id="iterationCount">0</strong> steps completed · <span id="timelineStep">0 of 8 tickets in this pass</span></span>
            <div class="timeline-track">
              <div class="timeline-fill" id="timelineFill"></div>
            </div>
          </div>
          <div class="metrics-grid">
            <div class="metric-card">
              <span class="label">Accuracy</span>
              <span class="value" id="accuracyValue">0%</span>
              <span style="color:var(--muted); font-size:0.82rem;">How many tickets the model now predicts correctly.</span>
            </div>
            <div class="metric-card">
              <span class="label">Average loss</span>
              <span class="value" id="lossValue">0.000</span>
              <span style="color:var(--muted); font-size:0.82rem;">Lower means the guesses match the true labels.</span>
            </div>
          </div>
        </aside>
        <section class="visual-board">
          <article class="focus-panel">
            <div class="focus-header">
              <strong id="focusTitle">Select a ticket to begin</strong>
              <span class="badge" id="focusBadge">Unseen</span>
            </div>
            <p id="focusDescription">As the model studies a ticket, these bars show the feature strengths on a 0–100 scale after normalisation.</p>
            <div class="feature-bars" id="featureBars"></div>
          </article>
          <article class="decision-panel">
            <h4 style="margin:0;">Decision meter</h4>
              <div class="decision-track">
                <span>Service request</span>
                <span>Incident</span>
              <div class="decision-indicator" id="decisionIndicator" style="left:50%;">50%</div>
            </div>
            <p id="decisionNote">The model hasn’t read anything yet, so it sits in the middle.</p>
          </article>
          <article class="panel" style="gap:16px;">
            <h4>Weights sliding into place</h4>
            <p>The AI keeps four numbers: one baseline bias and one weight per feature. When an incident is under-predicted, the corresponding weights move upward. For service requests they slide down.</p>
            <div class="weights-grid" id="weightsGrid"></div>
          </article>
          <article class="chart-panel">
            <h4 style="margin:0;">Accuracy over time</h4>
            <canvas id="accuracyChart" width="520" height="220"></canvas>
          </article>
          <article class="chart-panel">
            <div class="chart-header">
              <div>
                <h4 style="margin:0;">Learning signals</h4>
                <p class="muted" style="margin:6px 0 0;">Watch the loss curve flatten while the active ticket confidence stabilises.</p>
              </div>
              <div class="signal-grid">
                <div class="signal-card">
                  <span class="label">Learning rate</span>
                  <span class="value" id="learningRateValue">0.70</span>
                  <small>Step size used for every update.</small>
                </div>
                <div class="signal-card">
                  <span class="label">Latest error</span>
                  <span class="value" id="lastErrorValue">0.000</span>
                  <small>Positive means we under-called an incident.</small>
                </div>
                <div class="signal-card">
                  <span class="label">Gradient strength</span>
                  <span class="value" id="lastGradientValue">0.000</span>
                  <small>How sensitive the model was at that point.</small>
                </div>
                <div class="signal-card">
                  <span class="label">Weight push</span>
                  <span class="value" id="updateDirection">Awaiting run</span>
                  <small>Shows whether sliders moved up or down.</small>
                </div>
              </div>
            </div>
            <canvas id="learningChart" width="520" height="220"></canvas>
            <p class="muted" style="margin:0;">Loss is plotted in orange; the blue line tracks the model’s confidence for the current ticket as training progresses.</p>
          </article>
          <article class="panel" style="gap:16px;">
            <h4>Learning journal</h4>
            <p>Every step logs the ticket, the prediction, and whether the update pushed weights upward or downward.</p>
            <div class="log" id="log"></div>
          </article>
        </section>
      </div>
    </section>
  </main>
  <footer>
    © 2024 Foodsim Machine Learning Lab – Continue exploring experiments on the home page.
  </footer>
  <script>
    (() => {
      const documents = [
        { title: "Incident: Database outage", length: 420, urgencySignals: 28, impactScore: 0.92, label: 1 },
        { title: "Service request: Laptop setup", length: 310, urgencySignals: 5, impactScore: 0.35, label: 0 },
        { title: "Incident: Payment gateway failure", length: 560, urgencySignals: 24, impactScore: 0.88, label: 1 },
        { title: "Service request: Software access", length: 450, urgencySignals: 4, impactScore: 0.42, label: 0 },
        { title: "Incident: Network latency spike", length: 380, urgencySignals: 18, impactScore: 0.76, label: 1 },
        { title: "Service request: Update mailing list", length: 290, urgencySignals: 3, impactScore: 0.28, label: 0 },
        { title: "Incident: Security alert from IDS", length: 640, urgencySignals: 26, impactScore: 0.95, label: 1 },
        { title: "Service request: Conference room AV check", length: 360, urgencySignals: 6, impactScore: 0.33, label: 0 }
      ];

      const featureKeys = ["length", "urgencySignals", "impactScore"];
      const featureDescriptions = {
        length: "Ticket length",
        urgencySignals: "Urgent language",
        impactScore: "Impact cues"
      };

      const featureDisplay = {
        length: (value) => `${value} words`,
        urgencySignals: (value) => `${value} urgent terms`,
        impactScore: (value) => `${Math.round(value * 100)}% impact signal`
      };

      const featureStats = {};
      featureKeys.forEach((key) => {
        const values = documents.map((doc) => doc[key]);
        const min = Math.min(...values);
        const max = Math.max(...values);
        featureStats[key] = { min, range: max - min || 1 };
      });

      documents.forEach((doc) => {
        doc.normalised = featureKeys.map((key) => (doc[key] - featureStats[key].min) / featureStats[key].range);
      });

      const streamContainer = document.getElementById("documentStream");
      const focusTitle = document.getElementById("focusTitle");
      const focusBadge = document.getElementById("focusBadge");
      const focusDescription = document.getElementById("focusDescription");
      const featureBars = document.getElementById("featureBars");
      const decisionIndicator = document.getElementById("decisionIndicator");
      const decisionNote = document.getElementById("decisionNote");
      const weightsGrid = document.getElementById("weightsGrid");
      const iterationCount = document.getElementById("iterationCount");
      const timelineStep = document.getElementById("timelineStep");
      const timelineFill = document.getElementById("timelineFill");
      const accuracyValue = document.getElementById("accuracyValue");
      const lossValue = document.getElementById("lossValue");
      const logContainer = document.getElementById("log");
      const statusText = document.getElementById("statusText");
      const playButton = document.getElementById("playButton");
      const stepButton = document.getElementById("stepButton");
      const resetButton = document.getElementById("resetButton");
      const accuracyChart = document.getElementById("accuracyChart");
      const chartCtx = accuracyChart.getContext("2d");
      const learningChart = document.getElementById("learningChart");
      const learningCtx = learningChart.getContext("2d");
      const learningRateValue = document.getElementById("learningRateValue");
      const lastErrorValue = document.getElementById("lastErrorValue");
      const lastGradientValue = document.getElementById("lastGradientValue");
      const updateDirection = document.getElementById("updateDirection");

      const featureRefs = {};
      featureKeys.forEach((key) => {
        const wrapper = document.createElement("div");
        wrapper.className = "feature-bar";
        wrapper.innerHTML = `
          <div class="feature-header">
            <span>${featureDescriptions[key]}</span>
            <span class="feature-value" data-key="${key}">–</span>
          </div>
          <div class="feature-track"><span class="feature-fill" data-key="${key}" style="width:0%"></span></div>
        `;
        featureBars.appendChild(wrapper);
        featureRefs[key] = {
          value: wrapper.querySelector(".feature-value"),
          fill: wrapper.querySelector(".feature-fill"),
        };
      });

      const rowRefs = [];
      documents.forEach((doc, index) => {
        const button = document.createElement("button");
        button.type = "button";
        button.className = "doc-card";
        button.innerHTML = `
          <span class="doc-icon ${doc.label ? "incident" : "service"}">${doc.label ? "I" : "S"}</span>
          <div class="doc-details">
            <strong>${doc.title}</strong>
            <div class="doc-meta">
              <span>${doc.length} words</span>
              <span>${doc.urgencySignals} urgent terms</span>
              <span>${Math.round(doc.impactScore * 100)}% impact cues</span>
            </div>
            <div class="doc-confidence">Model confidence: <strong>–</strong></div>
          </div>
        `;
        streamContainer.appendChild(button);
        rowRefs.push({
          button,
          confidence: button.querySelector(".doc-confidence strong"),
        });
        button.addEventListener("click", () => {
          stop();
          focusOnDocument(index);
        });
      });

      const weights = {
        bias: 0,
        length: 0,
        urgencySignals: 0,
        impactScore: 0,
      };

      const weightRefs = {};
      const weightDescriptions = {
        bias: "Bias baseline",
        length: "Length weight",
        urgencySignals: "Urgency weight",
        impactScore: "Impact weight",
      };

      Object.keys(weights).forEach((key) => {
        const card = document.createElement("div");
        card.className = "weight-card";
        card.innerHTML = `
          <div style="color:var(--muted); font-size:0.82rem; letter-spacing:0.04em; text-transform:uppercase;">${weightDescriptions[key]}</div>
          <span class="value">0.000</span>
          <div class="weight-bar"><span style="left:50%; width:0%"></span></div>
        `;
        weightsGrid.appendChild(card);
        weightRefs[key] = {
          value: card.querySelector(".value"),
          bar: card.querySelector(".weight-bar span"),
        };
      });

      let iteration = 0;
      let indexPointer = 0;
      let playing = false;
      let loopId = null;
      const learningRate = 0.7;
      const accuracyHistory = [];
      const lossHistory = [];
      const confidenceHistory = [];
      const historyLimit = 60;

      function sigmoid(x) {
        return 1 / (1 + Math.exp(-x));
      }

      function predict(doc) {
        let sum = weights.bias;
        featureKeys.forEach((key, idx) => {
          sum += weights[key] * doc.normalised[idx];
        });
        return sigmoid(sum);
      }

      function updateWeights(doc, prediction) {
        const error = doc.label - prediction;
        const gradient = prediction * (1 - prediction);
        weights.bias += learningRate * error * gradient;
        featureKeys.forEach((key, idx) => {
          weights[key] += learningRate * error * gradient * doc.normalised[idx];
        });
        return { error, gradient };
      }

      function updateWeightCards() {
        const scale = 2.5;
        Object.entries(weights).forEach(([key, value]) => {
          weightRefs[key].value.textContent = value.toFixed(3);
          const clamped = Math.max(-1, Math.min(1, value / scale));
          const percentage = Math.abs(clamped) * 50;
          if (clamped >= 0) {
            weightRefs[key].bar.style.left = "50%";
            weightRefs[key].bar.style.width = `${percentage}%`;
          } else {
            weightRefs[key].bar.style.left = `${50 - percentage}%`;
            weightRefs[key].bar.style.width = `${percentage}%`;
          }
        });
      }

      function updateTimeline(docIndex) {
        const stepText = `${docIndex + 1} of ${documents.length} tickets in this pass`;
        timelineStep.textContent = stepText;
        const fillWidth = ((docIndex + 1) / documents.length) * 100;
        timelineFill.style.width = `${fillWidth}%`;
      }

      function updateDocumentCards(activeIndex) {
        documents.forEach((doc, index) => {
          const probability = predict(doc);
          const predictedLabel = probability >= 0.5 ? 1 : 0;
          const confidencePercent = Math.round(probability * 100);
          rowRefs[index].confidence.textContent = `${confidencePercent}%`;
          rowRefs[index].button.classList.toggle("active", index === activeIndex);
          rowRefs[index].button.setAttribute("aria-pressed", index === activeIndex ? "true" : "false");
          if (predictedLabel === doc.label) {
            rowRefs[index].button.dataset.state = "correct";
          } else {
            rowRefs[index].button.dataset.state = "learning";
          }
        });
      }

      function setDecision(probability) {
        const percent = Math.max(4, Math.min(96, probability * 100));
        decisionIndicator.style.left = `${percent}%`;
        decisionIndicator.textContent = `${Math.round(probability * 100)}%`;
        if (probability >= 0.5) {
          decisionNote.textContent = "Needle to the right means the AI senses an incident.";
        } else {
          decisionNote.textContent = "Needle to the left means the AI interprets a service request.";
        }
      }

      function computeMetrics() {
        let correct = 0;
        let loss = 0;
        documents.forEach((doc) => {
          const probability = predict(doc);
          const clipped = Math.min(Math.max(probability, 1e-6), 1 - 1e-6);
          const predictedLabel = probability >= 0.5 ? 1 : 0;
          if (predictedLabel === doc.label) {
            correct += 1;
          }
          loss += -doc.label * Math.log(clipped) - (1 - doc.label) * Math.log(1 - clipped);
        });
        return {
          accuracy: correct / documents.length,
          loss: loss / documents.length,
        };
      }

      function drawAccuracyChart() {
        const width = accuracyChart.width;
        const height = accuracyChart.height;
        chartCtx.clearRect(0, 0, width, height);
        chartCtx.fillStyle = "rgba(7, 10, 28, 0.95)";
        chartCtx.fillRect(0, 0, width, height);
        chartCtx.strokeStyle = "rgba(148, 163, 209, 0.25)";
        chartCtx.lineWidth = 1;
        chartCtx.beginPath();
        chartCtx.moveTo(40, 20);
        chartCtx.lineTo(40, height - 30);
        chartCtx.lineTo(width - 10, height - 30);
        chartCtx.stroke();
        chartCtx.font = "12px Inter, sans-serif";
        chartCtx.fillStyle = "rgba(148, 163, 209, 0.78)";
        chartCtx.fillText("100%", 5, 28);
        chartCtx.fillText("0%", 14, height - 32);
        if (accuracyHistory.length === 0) {
          return;
        }
        chartCtx.strokeStyle = "rgba(56, 189, 248, 0.85)";
        chartCtx.lineWidth = 2;
        chartCtx.beginPath();
        accuracyHistory.forEach((acc, idx) => {
          const x = 40 + ((width - 60) * idx) / Math.max(1, accuracyHistory.length - 1);
          const y = height - 30 - acc * (height - 60);
          if (idx === 0) {
            chartCtx.moveTo(x, y);
          } else {
            chartCtx.lineTo(x, y);
          }
        });
        chartCtx.stroke();
      }

      function drawLearningChart() {
        const width = learningChart.width;
        const height = learningChart.height;
        learningCtx.clearRect(0, 0, width, height);
        learningCtx.fillStyle = "rgba(7, 10, 28, 0.95)";
        learningCtx.fillRect(0, 0, width, height);
        learningCtx.strokeStyle = "rgba(148, 163, 209, 0.25)";
        learningCtx.lineWidth = 1;
        learningCtx.beginPath();
        learningCtx.moveTo(40, 20);
        learningCtx.lineTo(40, height - 30);
        learningCtx.lineTo(width - 10, height - 30);
        learningCtx.stroke();
        learningCtx.font = "12px Inter, sans-serif";
        learningCtx.fillStyle = "rgba(148, 163, 209, 0.78)";
        learningCtx.fillText("Loss", 4, 28);
        learningCtx.fillText("0", 20, height - 32);
        if (lossHistory.length === 0) {
          return;
        }
        const maxLoss = Math.max(...lossHistory, 0.0001);
        learningCtx.strokeStyle = "rgba(249, 115, 22, 0.9)";
        learningCtx.lineWidth = 2;
        learningCtx.beginPath();
        lossHistory.forEach((loss, idx) => {
          const x = 40 + ((width - 60) * idx) / Math.max(1, lossHistory.length - 1);
          const y = height - 30 - (loss / (maxLoss * 1.1)) * (height - 60);
          if (idx === 0) {
            learningCtx.moveTo(x, y);
          } else {
            learningCtx.lineTo(x, y);
          }
        });
        learningCtx.stroke();
        learningCtx.strokeStyle = "rgba(56, 189, 248, 0.9)";
        learningCtx.beginPath();
        confidenceHistory.forEach((confidence, idx) => {
          const x = 40 + ((width - 60) * idx) / Math.max(1, confidenceHistory.length - 1);
          const y = height - 30 - confidence * (height - 60);
          if (idx === 0) {
            learningCtx.moveTo(x, y);
          } else {
            learningCtx.lineTo(x, y);
          }
        });
        learningCtx.stroke();
      }

      function addLogEntry({ iteration, doc, probability, error }) {
        const entry = document.createElement("div");
        entry.className = "log-entry";
        const direction = error > 0 ? "upward" : "downward";
        const leaning = probability >= 0.5 ? "incident" : "service request";
        entry.innerHTML = `
          <strong>Step ${iteration}</strong> · "${doc.title}"<br>
          Model now leans ${leaning} with ${(probability * 100).toFixed(1)}% confidence.<br>
          Weights nudged ${direction} by ${(Math.abs(error) * 100).toFixed(1)}% to cut the loss.
        `;
        logContainer.prepend(entry);
        while (logContainer.children.length > 8) {
          logContainer.removeChild(logContainer.lastChild);
        }
      }

      function focusOnDocument(index) {
        const doc = documents[index];
        focusTitle.textContent = doc.title;
        focusBadge.textContent = doc.label ? "Incident" : "Service request";
        focusBadge.className = `badge ${doc.label ? "incident" : "service"}`;
        focusDescription.textContent = "Feature strength after normalisation (0 means the least intense ticket in the set, 100 the strongest).";
        featureKeys.forEach((key, idx) => {
          const normalised = doc.normalised[idx];
          featureRefs[key].value.textContent = featureDisplay[key](doc[key]);
          featureRefs[key].fill.style.width = `${Math.round(normalised * 100)}%`;
        });
        const probability = predict(doc);
        setDecision(probability);
        updateDocumentCards(index);
      }

      function stepLearning() {
        const doc = documents[indexPointer];
        const probability = predict(doc);
        focusOnDocument(indexPointer);
        const { error, gradient } = updateWeights(doc, probability);
        iteration += 1;
        updateDocumentCards(indexPointer);
        updateWeightCards();
        const metrics = computeMetrics();
        accuracyHistory.push(metrics.accuracy);
        lossHistory.push(metrics.loss);
        confidenceHistory.push(probability);
        if (accuracyHistory.length > historyLimit) {
          accuracyHistory.shift();
        }
        if (lossHistory.length > historyLimit) {
          lossHistory.shift();
        }
        if (confidenceHistory.length > historyLimit) {
          confidenceHistory.shift();
        }
        iterationCount.textContent = iteration;
        accuracyValue.textContent = `${Math.round(metrics.accuracy * 100)}%`;
        lossValue.textContent = metrics.loss.toFixed(3);
        learningRateValue.textContent = learningRate.toFixed(2);
        lastErrorValue.textContent = error.toFixed(3);
        lastGradientValue.textContent = gradient.toFixed(3);
        updateDirection.textContent = error >= 0 ? "Pushing weights up" : "Sliding weights down";
        drawAccuracyChart();
        drawLearningChart();
        addLogEntry({ iteration, doc, probability, error });
        statusText.textContent = "The AI is learning from the tickets.";
        updateTimeline(indexPointer);
        indexPointer = (indexPointer + 1) % documents.length;
        if (indexPointer === 0) {
          timelineFill.style.width = "0%";
          timelineStep.textContent = "0 of 8 tickets in this pass";
        }
      }

      function reset() {
        stop();
        iteration = 0;
        indexPointer = 0;
        Object.keys(weights).forEach((key) => {
          weights[key] = 0;
        });
        accuracyHistory.length = 0;
        lossHistory.length = 0;
        confidenceHistory.length = 0;
        updateWeightCards();
        iterationCount.textContent = "0";
        accuracyValue.textContent = "0%";
        lossValue.textContent = "0.000";
        logContainer.innerHTML = "";
        learningRateValue.textContent = learningRate.toFixed(2);
        lastErrorValue.textContent = "0.000";
        lastGradientValue.textContent = "0.000";
        updateDirection.textContent = "Awaiting run";
        drawAccuracyChart();
        drawLearningChart();
        decisionIndicator.style.left = "50%";
        decisionIndicator.textContent = "50%";
        decisionNote.textContent = "The model hasn’t read anything yet, so it sits in the middle.";
        focusTitle.textContent = "Select a ticket to begin";
        focusBadge.textContent = "Unseen";
        focusBadge.className = "badge";
        focusDescription.textContent = "As the model studies a ticket, these bars show the feature strengths on a 0–100 scale after normalisation.";
        featureKeys.forEach((key) => {
          featureRefs[key].value.textContent = "–";
          featureRefs[key].fill.style.width = "0%";
        });
        rowRefs.forEach(({ button, confidence }) => {
          button.classList.remove("active");
          button.removeAttribute("aria-pressed");
          confidence.textContent = "–";
        });
        timelineFill.style.width = "0%";
        timelineStep.textContent = "0 of 8 tickets in this pass";
        statusText.textContent = "The model is idle and ready.";
      }

      function play() {
        if (playing) {
          stop();
          return;
        }
        playing = true;
        playButton.textContent = "Pause training";
        statusText.textContent = "The AI is training in real time.";
        loopId = setInterval(() => {
          stepLearning();
        }, 1300);
      }

      function stop() {
        playing = false;
        playButton.textContent = "Play training";
        if (loopId) {
          clearInterval(loopId);
          loopId = null;
        }
      }

      playButton.addEventListener("click", () => {
        if (playing) {
          stop();
          statusText.textContent = "Paused. Resume whenever you’re ready.";
        } else {
          play();
        }
      });

      stepButton.addEventListener("click", () => {
        if (!playing) {
          stepLearning();
        }
      });

      resetButton.addEventListener("click", reset);

      reset();
    })();
  </script>
</body>
</html>
